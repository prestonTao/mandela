package config

import (
	"mandela/core/engine"
	//	"mandela/core/utils"
)

const (
	C_Server_name = "mandela" //网络名称
	C_root_name   = "root"    //网络管理员域名

	//服务器角色，只有局域网开发模式才能用
	C_role_client = "client" //客户端模式
	C_role_super  = "super"  //超级节点模式

)

var (
	Init_IsGlobalOnlyAddress        = false //本地ip是否是公网全球唯一ip
	Init_LocalIP                    = ""    //本地ip地址(局域网ip或公网全球唯一ip)
	Init_LocalPort           uint16 = 9981  //本地监听端口

	Init_IsMapping             = false //是否映射了端口
	Init_GatewayAddress        = ""    //网关地址
	Init_GatewayPort    uint16 = 9981  //网关端口

	Mode_local = true          //是否是局域网开发模式
	Init_role  = C_role_client //服务器角色，当为开发模式时可用

	//	LnrTCP   net.Listener //获得并占用一个TCP端口
	IsOnline      = false //是否已经连接到网络中了
	IsNotInternet = true  //是否没有因特网

	//根节点公钥
	Root_publicKeyStr = []byte{45, 45, 45, 45, 45, 66, 69, 71, 73, 78, 32, 231, 167, 129, 233,
		146, 165, 45, 45, 45, 45, 45, 10, 77, 73, 73, 69, 112, 65, 73, 66, 65, 65, 75, 67, 65, 81, 69, 65,
		49, 119, 65, 88, 52, 117, 77, 50, 100, 54, 105, 107, 103, 86, 57, 53, 82, 81, 104, 106, 74, 83,
		78, 71, 120, 73, 52, 87, 53, 111, 103, 103, 87, 66, 54, 103, 53, 108, 65, 81, 73, 53, 70, 43, 116,
		109, 57, 89, 10, 107, 56, 118, 112, 86, 55, 113, 79, 50, 75, 68, 71, 69, 100, 110, 75, 85, 113,
		119, 114, 47, 108, 66, 66, 78, 53, 90, 87, 69, 101, 82, 88, 118, 74, 86, 88, 65, 103, 110, 72,
		115, 97, 85, 117, 112, 84, 121, 118, 100, 55, 83, 70, 98, 87, 76, 112, 97, 51, 67, 86, 65, 86, 48,
		54, 10, 48, 98, 119, 70, 74, 77, 50, 122, 85, 48, 75, 118, 109, 51, 83, 107, 105, 53, 100, 104,
		119, 65, 111, 74, 118, 74, 113, 56, 110, 114, 100, 101, 99, 114, 111, 81, 57, 51, 104, 119, 101,
		105, 100, 86, 102, 53, 80, 100, 77, 105, 102, 117, 120, 109, 74, 43, 56, 50, 66, 47, 97, 72, 82,
		68, 10, 56, 83, 71, 73, 106, 111, 43, 82, 99, 47, 105, 119, 86, 85, 77, 101, 109, 74, 115, 117, 65,
		71, 43, 122, 105, 108, 109, 111, 74, 98, 69, 57, 99, 84, 74, 89, 112, 103, 83, 98, 122, 70, 86, 120,
		100, 53, 81, 76, 120, 122, 101, 83, 101, 112, 90, 65, 107, 66, 108, 50, 112, 120, 48, 121, 10, 115,
		106, 117, 84, 53, 110, 81, 120, 86, 66, 86, 109, 100, 65, 74, 99, 110, 74, 69, 72, 105, 110, 110, 69,
		122, 73, 74, 80, 77, 98, 118, 77, 72, 100, 54, 119, 67, 87, 68, 111, 78, 118, 109, 73, 65, 113, 78,
		121, 85, 100, 113, 48, 57, 116, 114, 121, 98, 54, 118, 110, 122, 84, 65, 82, 10, 71, 43, 43, 121,
		53, 106, 53, 118, 105, 70, 121, 74, 99, 115, 82, 48, 97, 101, 117, 85, 70, 66, 101, 121, 78, 54,
		100, 84, 86, 103, 68,
		122, 57, 76, 68, 102, 107, 81, 73, 68, 65, 81, 65, 66, 65, 111, 73, 66, 65, 81, 67, 51, 115, 109,
		109, 50, 80, 111, 73, 99, 76, 79, 103, 90, 10, 98, 98, 83, 85, 113, 102, 122, 107, 68, 48, 98, 52,
		121, 53, 112, 47, 98, 57, 71, 75, 50, 79, 105, 75, 118, 57, 57, 54, 78, 71, 98, 54, 103, 120, 112,
		65, 100, 86, 111, 121, 122, 99, 65, 100, 69, 81, 107, 75, 50, 88, 87, 72, 117, 51, 108, 47, 79, 90,
		122, 118, 88, 76, 67, 47, 10, 97, 115, 85, 88, 54, 78, 86, 70, 100, 89, 117, 56, 109, 98, 68, 73, 70, 53, 105, 111, 103,
		52, 72, 53, 71, 121, 106, 113, 49, 109, 57, 74, 107, 104, 109, 101, 100, 55, 74, 66, 90, 115, 117, 81, 71,
		81, 115, 110, 110, 76, 113, 50, 86, 105, 112, 55, 120, 86, 102, 97, 89, 75, 57, 71, 10, 81, 78, 65,
		101, 52, 67, 70, 56, 47, 57, 102, 67, 86, 118, 99, 122, 73, 79, 103, 43, 89, 87, 89, 101, 57, 75, 115,
		90, 84, 48, 108, 73, 85, 101, 52, 69, 106, 75, 81, 57, 70, 56, 111, 83, 100, 109, 100, 77, 77, 120, 74,
		109, 113, 87, 86, 110, 68, 84, 85, 120, 116, 116, 67, 52, 10, 76, 68, 99, 56, 73, 81, 87, 56, 67, 85,
		98, 103, 75, 115, 85, 106, 88, 107, 109, 68, 72, 55, 81, 43, 47, 100, 113, 116, 118, 52, 57, 73, 69,
		77, 68, 85, 81, 117, 86, 48, 100, 50, 43, 79, 55, 121, 48, 89, 109, 70, 48, 99, 67, 117, 87, 85, 97,
		106, 86, 87, 53, 69, 67, 55, 10, 104, 78, 104, 80, 55, 114, 89, 110, 57, 103, 52, 65, 79, 114, 49,
		85, 110, 117, 57, 67, 103, 67, 53, 53, 110, 53, 118, 89, 111, 101, 57, 52, 119, 82, 54, 77, 51, 57,
		55, 79, 90, 98, 112, 120, 80, 121, 70, 115, 106, 88, 83, 86, 43, 99, 115, 56, 82, 106, 119, 74, 47,
		86, 116, 102, 10, 101, 89,
		67, 119, 86, 82, 65, 66, 65, 111, 71, 66, 65, 80, 90, 57, 115, 114, 122, 54, 103, 88, 85, 71, 67, 49,
		122, 52, 57, 68, 77, 50, 71, 118, 116, 79, 114, 116, 81, 119, 114, 67, 113, 114, 112, 74, 84, 97,
		111, 81, 55, 74, 100, 97, 52, 84, 85, 89, 100, 56, 110, 81, 81, 85, 10, 116, 121, 103, 97, 100, 83,
		54, 118, 109, 114, 99, 98, 56, 111, 114, 55, 48, 102, 71, 57, 81, 70, 104, 83, 109, 67, 88, 100, 75,
		89, 97, 65, 74, 73, 72, 105, 77, 81, 76, 88, 79, 49, 99, 77, 70, 73, 119, 74, 121, 119, 87, 77, 104,
		80, 69, 103, 117, 122, 83, 48, 106, 115, 87, 85, 10, 105, 68, 110, 121, 84, 120, 43, 88, 76, 88, 50,
		111, 54, 85, 57, 102, 84, 51, 118, 121, 51, 117, 78, 90, 51, 69, 102, 68, 55, 98, 88, 55, 56, 87, 104,
		73, 118, 100, 51, 85,
		76, 118, 119, 43, 111, 49, 86, 66, 47, 56, 100, 71, 100, 80, 115, 66, 65, 111, 71, 66, 65, 78, 57, 76,
		10, 90, 105, 104, 82, 48, 82, 81, 71, 68, 120, 90, 109, 117, 98, 50, 70, 118, 79, 118, 68, 50, 73, 51,
		121, 88, 113, 121, 97, 107, 90, 71, 74, 68, 43, 116, 51, 82, 50, 89, 53, 84, 66, 88, 100, 73, 105, 53, 43,
		48, 67, 104, 72, 74, 50, 74, 122, 80, 110, 89, 67, 56, 112, 119, 72, 10, 105, 81, 71, 75, 101, 49, 66,
		107, 79, 76, 84, 110, 102, 89, 105, 77, 110, 84, 108, 69, 90, 104, 100, 114, 111, 73, 79, 88, 82, 65,
		118, 74, 66, 115, 121, 73, 43, 71, 83, 69, 69, 122, 88, 112, 72, 43, 69, 102, 114, 122, 84, 102, 114, 43,
		56, 115, 116, 100, 107, 81, 75, 69, 117, 106, 10, 77, 105, 98, 110, 56, 85, 101, 57, 111, 80, 107,
		100, 122, 80, 71, 65, 113, 76, 75, 107, 111, 70, 79, 118, 89, 118, 83, 114, 102, 65, 49, 70, 97, 73,
		54, 70, 56, 114, 83, 82, 65, 111, 71, 66, 65, 74, 80, 117, 100, 71, 114, 43, 88, 78, 117, 67, 117, 83,
		99, 102, 77, 107, 47, 90, 10, 49, 79, 43, 109, 70, 84, 54, 55, 120, 49, 103, 69, 107, 48, 51, 83, 117,
		72, 53, 76, 89, 104, 107, 75, 57, 119, 56, 57, 78, 109, 55, 81, 106, 43, 117, 57, 108, 84, 53, 106, 110, 90, 76,
		118, 98, 117, 48, 67, 110, 77, 108, 99, 76, 49, 88, 83, 110, 65, 86, 57, 97, 103, 75, 83, 10, 118, 86,
		90, 71, 68, 101, 119, 75, 105, 69, 54, 66, 114, 89, 77, 117, 68, 87, 53, 84, 71, 121, 89, 114, 52, 113,
		54, 75, 47, 110, 83, 78, 53, 65, 81, 67, 55, 73, 71, 108, 70, 87, 81, 112, 68, 51, 122, 88, 85, 114, 105,
		115, 49, 104, 47, 85, 79, 109, 80, 72, 114, 115, 53, 100, 10, 87, 108, 67, 102, 57, 51, 77, 43, 101, 77,
		82, 105, 81, 49, 120, 84, 115, 57, 74, 65, 56, 115, 119, 66, 65, 111, 71, 65, 85, 77, 108, 51, 119,
		88, 105, 119, 101, 49, 48, 104, 48, 107, 111, 67, 81, 51, 97, 67, 102, 111, 53, 82, 54, 68, 70, 98,
		88, 88, 108, 105, 49, 49, 80, 79, 10, 104, 98, 79, 88, 67, 110, 52, 75, 99, 66, 75, 99, 106, 108, 80,
		108, 80, 100, 49, 89, 101, 51, 56, 85, 104, 120, 47, 84, 53, 79, 50, 52, 47, 79, 121, 56, 90, 114, 54,
		76, 52, 97, 43, 114, 78, 70, 56, 106, 100, 120, 101, 118, 70, 67, 81, 108, 89, 57, 97, 122, 107, 77,
		118, 47, 10,
		103, 76, 114, 66, 109, 54, 82, 74, 83, 119, 84, 52, 79, 114, 118, 54, 54, 78, 100, 82, 85, 79, 104, 78,
		78, 113, 90, 111, 51, 99, 122, 67, 108, 86, 55, 118, 90, 98, 82, 79, 55, 68, 75, 67, 57, 112, 70, 69,
		57, 55, 85, 109, 75, 73, 68, 89, 47, 89, 113, 90, 106, 68, 101, 106, 10, 100, 52, 85, 119, 53, 88, 69, 67,
		103, 89, 65, 101, 47, 84, 112, 47, 80, 122, 106, 48, 69, 107, 43, 73, 97, 117, 66, 111, 105, 83, 106,
		55, 79, 107, 55, 97, 101, 43, 98, 52, 75, 75, 104, 69, 73, 70, 89, 82, 65, 104, 106, 107, 102, 106, 90,
		104, 78, 121, 51, 100, 70, 101, 82, 84, 10, 100, 81, 103, 89, 116, 117, 70, 86, 120, 78, 107, 106, 51,
		82, 109, 116, 121, 120, 74, 79, 78, 57, 83, 119, 117, 118, 109, 54, 99, 105, 68, 65, 53, 106, 43, 98,
		120, 66, 80, 69, 99, 77, 90, 88, 89, 48, 110, 101, 52, 105, 103, 57, 113, 84, 66, 114, 120, 110, 99,
		43, 71, 82, 119, 57, 10, 97, 51, 66, 72, 116, 89, 71, 75, 100, 86, 122, 77, 75, 79, 77, 85, 65, 66, 77,
		89, 72, 82, 103, 57, 73, 80, 102, 119, 73, 77, 99, 76, 74, 97, 66, 56, 43, 68, 82, 86, 72, 55, 77, 87, 74, 114,
		111, 103, 119, 54, 120, 106, 54, 81, 61, 61, 10, 45, 45, 45, 45, 45, 69, 78, 68, 32, 231, 167, 129,
		233, 146, 165, 45, 45, 45, 45, 45, 10}
)

var (
// SuperNodeIp   string           //超级节点ip地址
// SuperNodePort int              //超级节点端口
//	TCPListener *net.TCPListener //本地监听TCP端口
)

func init() {
	engine.GlobalInit("console", "", "debug", 1)
	//	engine.GlobalInit("file", `{"filename":"conf/log.txt"}`, "", 1000)

	// engine.Log.Debug("session handle receive, %d, %v", msg.Code(), msg.Content())
	// engine.Log.Debug("test debug")
	// engine.Log.Warn("test warn")
	// engine.Log.Error("test error")

	//	AutoRole()
}

/*
	获得一个TCP监听
*/
//func GetTCPListener(ip string, port int) (*net.TCPListener, error) {
//	tcpAddr, err := net.ResolveTCPAddr("tcp4", ip+":"+strconv.Itoa(int(port)))
//	if err != nil {
//		// Log.Error("这个地址不符合规范：%s", ip+":"+strconv.Itoa(int(port)))
//		return nil, err
//	}
//	var listener *net.TCPListener
//	listener, err = net.ListenTCP("tcp4", tcpAddr)
//	if err != nil {
//		// Log.Error("监听一个地址失败：%s", ip+":"+strconv.Itoa(int(port)))
//		// Log.Error("%v", err)
//		return nil, err
//	}
//	// Log.Debug("监听一个地址：%s", ip+":"+strconv.Itoa(int(port)))
//	// fmt.Println("监听一个地址：", ip+":"+strconv.Itoa(int(port)))
//	// fmt.Println(ip + ":" + strconv.Itoa(int(port)) + "成功启动服务器")
//	return listener, nil
//}

/*
	获得本机是否是超级节点
*/
func CheckIsSuperPeer() bool {
	if Mode_local {
		switch Init_role {
		case C_role_client:
			return false
		case C_role_super:
			return true
		}
		return false
	}
	if Init_IsGlobalOnlyAddress {
		return true
	}
	if Init_IsMapping {
		return true
	}
	return false
}

/*
	获得自己的节点地址
	@return   string    ip地址
	@return   int       端口号
*/
func GetHost() (string, uint16) {
	//局域网开发模式
	if Mode_local {
		return Init_LocalIP, Init_LocalPort
	}
	if Init_IsGlobalOnlyAddress {
		return Init_LocalIP, Init_LocalPort
	}
	if Init_IsMapping {
		return Init_GatewayAddress, Init_GatewayPort
	}
	return "", 0
}
